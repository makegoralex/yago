# Evotor Android app (MVP)

Этот модуль — минимальное Android-приложение для Эвотора, которое можно открыть в Android Studio и запустить, чтобы проверить, что связка репозитория и Android-проекта работает.

## Где лежит проект

```
/workspace/yago/android-app
```

Открывать нужно именно эту папку (а не весь репозиторий).

## Как запустить

1. **Android Studio → File → Open**.
2. Выберите папку `android-app`.
3. Дождитесь синхронизации Gradle.
   - Если Android Studio попросит скачать/обновить Gradle Wrapper — согласитесь.
   - Если появится ошибка про `gradle-wrapper.jar`, выберите **"Install Gradle"** или запустите **"Sync Project with Gradle Files"** ещё раз — Android Studio скачает нужные файлы.
4. Запустите эмулятор (**Tools → Device Manager**) или подключите устройство по USB.
5. Нажмите **Run ▶**.

## Вход в приложение

На первом экране нужно указать данные кассира:

- **Email** и **Пароль** — учётные данные кассира.
- **Organization ID** — можно оставить пустым, если кассир закреплён за одной организацией.

Адрес backend зашит в приложение по умолчанию: `https://yago-app.ru`.

После входа приложение покажет подтверждение, что POS готов, и название организации (если backend вернул его при логине; иначе покажет ID организации).

## Что вы увидите после входа

На экране будет текст:

> «Эвотор POS готов. Организация: ...»

И кнопка «Выйти».

## Следующий шаг

Дальше можно добавлять экран POS, синхронизацию с сервером и интеграцию с Эвотор SDK.

## Иконка на главном экране Эвотор

Для отображения плитки на главном экране терминала в `AndroidManifest.xml`
у активити входа добавлены:

- `android.intent.category.EVOTOR` в `intent-filter`;
- `android:icon` и `android:label`;
- `meta-data` `ru.evotor.launcher.BACKGROUND_COLOR`.

Это соответствует требованиям документации Evotor для отображения иконки приложения на рабочем столе терминала.

## TLS для старых прошивок терминалов

Если терминал показывает ошибку `Trust anchor for certification path not found`
при входе на `https://yago-app.ru`, приложение использует
`network_security_config` и дополнительно доверяет встроенному сертификату
`ISRG Root X1` (`res/raw/isrg_root_x1.pem`) вместе с системными и user CA.

Это помогает старым прошивкам корректно валидировать цепочку сертификатов.

Дополнительно перед логином приложение выполняет preflight-запрос к
`/healthz`. Если TLS/SSL соединение не устанавливается, на экране входа
показывается расширенная диагностическая ошибка подключения.
